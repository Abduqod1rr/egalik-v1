<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Egalik</title>
<link rel="stylesheet" href="main.css">
</head>
<body>

<aside class="sidebar">
  <div class="logo">EGALIK</div>
  <nav>
    <a data-page="home" class="active">Asosiy</a>
    <a data-page="categories">Kategoriyalar</a>
    <a data-page="add">E’lon qo‘shish</a>
    <a data-page="profile">Mening e’lonlarim</a>
  </nav>
</aside>

<main class="content">

<!-- Home -->
<section id="home" class="page">
  <header class="topbar">
    <input type="text" placeholder="Nimalar qidiryapsiz?">
    <select class="select"> 
      <option>Yangi</option>
      <option>Mashhur</option>
      <option>Ko‘p qidirilgan</option>
    </select>
  </header>
  <div class="ads-grid"></div>
</section>

<!-- Categories -->
<section id="categories" class="page" style="display:none">
  <div class="categories">
    <div class="category-card">Texnika</div>
    <div class="category-card">Uskunalar</div>
    <div class="category-card">Transport</div>
    <div class="category-card">Ko‘chmas-mulk</div>
  </div>
</section>

<!-- Add -->
<section id="add" class="page" style="display:none">
  <form id="addForm" enctype="multipart/form-data">
    <select name="holat" required>
      <option value="sotiladi">Sotiladi</option>
      <option value="ijaraga">Ijaraga</option>    
    </select>

    <input type="text" name="title" placeholder="E’lon nomi" required>

    <select name="kategoriya" required>
      <option value="texnika">Texnika</option>
      <option value="uskunalar">Uskunalar</option>
      <option value="transport">Transport</option>
      <option value="kochmas-mulk">Ko'chmas-mulk</option>
    </select>

    <textarea name="tavsilot" rows="3" placeholder="Tafsilot" required></textarea>
    <input type="number" name="narx" placeholder="Narxi" required>
    <input type="file" name="rasm" required>
    <input type="text" name="number" placeholder="Telefon raqam" required>
    <input type="text" name="telegram" placeholder="Telegram username" required>

    <button type="submit">E’lonni joylash</button>
  </form>
</section>

<!-- Profile -->
<section id="profile" class="page" style="display:none">
  <div class="ads-grid"></div>
</section>

</main>

<script>
const API_BASE = "https://egalik-api-v01.onrender.com/";

// Navbar switching
document.querySelectorAll(".sidebar nav a").forEach(link => {
  link.addEventListener("click", () => {
    document.querySelectorAll(".sidebar nav a").forEach(a => a.classList.remove("active"));
    link.classList.add("active");
    let page = link.dataset.page;
    document.querySelectorAll(".page").forEach(p => p.style.display="none");
    document.getElementById(page).style.display="block";
  });
});

// Load products
document.addEventListener("DOMContentLoaded", async function() {
  const API_BASE = "https://egalik-api-v01.onrender.com/";

  async function loadProducts() {
    try {
      let res = await fetch(API_BASE);
      if(!res.ok) throw new Error("Network response not ok");

      let data = await res.json();

      let grid = document.querySelector("#home .ads-grid");
      grid.innerHTML = "";

      data.forEach(item => {
        grid.innerHTML += `
          <article class="ad-card">
            <img src="${item.rasm || 'images/noimage.jpg'}" alt="Rasm">
            <h3>${item.title}</h3>
            <p>Narxi: ${item.narx}</p>
            <p>Telefon raqam: ${item.number}</p>
            <p>Telegram: ${item.telegram}</p>
            <div class="ad-actions">
              <button class="badge blue">${item.holat}</button>
            </div>
          </article>
        `;
      });
    } catch(err) {
      console.error("Fetch error:", err);
    }
  }

  loadProducts();
});


// Add form
document.getElementById("addForm").addEventListener("submit", async function(e){
  e.preventDefault();
  let formData = new FormData(this);

  try {
    let res = await fetch(API_BASE + "/add/", {
      method: "POST",
      body: formData
    });

    if(res.ok){
      alert("E’lon muvaffaqiyatli qo‘shildi!");
      this.reset();
      loadProducts();
    } else {
      alert("Xato: E’lon qo‘shilmadi");
    }
  } catch(err){
    console.error("Add fetch error:", err);
    alert("Serverga ulanishda xato");
  }
});
</script>

</body>
</html>

